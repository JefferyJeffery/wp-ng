!function(e,t){"use strict";function n(e){var n,o=t.element();for(e=t.element(e),n=0;n<this.length;n++)o.push(this[n]);for(n=0;n<e.length;n++)o.push(e[n]);return o}function o(e){if(void 0===e.clientX&&void 0===e.clientY){var t=e.touches||e.originalEvent.touches;t&&t.length&&(e.clientX=t[0].clientX,e.clientY=t[0].clientY),e.preventDefault()}}function r(e){if(e=e[0],e.previousElementSibling)return t.element(e.previousElementSibling);for(var n=e.previousSibling;null!=n&&1!=n.nodeType;)n=n.previousSibling;return t.element(n)}function i(e,t){return parseInt(e.css(t))||0}function l(e,n){function o(){return 0}var r={},l=t.element(e),s=e.getBoundingClientRect(),a=n?i:o;return r.left=s.left-a(l,"margin-left")-a(l,"border-left"),r.right=s.right+a(l,"margin-right")+a(l,"border-right"),r.top=s.top-a(l,"margin-top")-a(l,"border-top"),r.bottom=s.bottom+a(l,"margin-bottom")+a(l,"border-bottom"),r.width=r.right-r.left,r.height=r.bottom-r.top,r}function s(e,t){var n=r(e);n.length>0?n.after(t):e.parent().prepend(t)}function a(e){for(var n=e.parent(),o=n.css("position"),r=n.css("transform");n.length>0&&"BODY"!==n[0].tagName&&("static"===o||!o)&&("none"===r||!r);)n=n.parent(),o=n.css("position"),r=n.css("transform");return 0===n.length&&(n=t.element(document.documentElement)),n}function c(e,n){if(e instanceof t.element&&(e=e[0]),null!==m)return e[m](n)}var d=100;t.element(document.head).append(["<style>.sv-helper{position: absolute !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var u=document.documentElement,m=u.matches?"matches":u.matchesSelector?"matchesSelector":u.webkitMatches?"webkitMatches":u.webkitMatchesSelector?"webkitMatchesSelector":u.msMatches?"msMatches":u.msMatchesSelector?"msMatchesSelector":u.mozMatches?"mozMatches":u.mozMatchesSelector?"mozMatchesSelector":null;if(null==m)throw"This browser doesn't support the HTMLElement.matches method";var p=t.element.prototype.closest||function(e){for(var n=this[0].parentNode;n!==document.documentElement&&!n[m](e);)n=n.parentNode;return n[m](e)?t.element(n):t.element()},h=t.module("angular-sortable-view",[]);h.directive("svRoot",[function(){function e(e,t,n){return n?e.x-t.x<0:e.y-t.y<0}function t(e){return r[e]}function n(e){delete r[e]}var o,r=Object.create(null),i=document.body;return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse","$element",function(a,d,u,m,h){var v,f,g,$,x,y,b,w=u(d.svRoot)(a)||a.$id,S=!1,C=m(d.svOnSort),E=!1;r[w]||(r[w]=[]),d.svOnStart=d.$$element[0].attributes["sv-on-start"],d.svOnStart=d.svOnStart&&d.svOnStart.value,d.svOnStop=d.$$element[0].attributes["sv-on-stop"],d.svOnStop=d.svOnStop&&d.svOnStop.value;var M=m(d.svOnStart),T=m(d.svOnStop),P=function(e,t){var n=h[0],o=n.scrollTop,r=Math.max(0,n.scrollHeight-n.clientHeight),i=Math.min(Math.max(0,n.scrollTop+e),r);E=!0,i!==o?(n.scrollTop=i,b=setTimeout(function(){b=null,E&&P(e,t)},t)):E=!1};if(this.sortingInProgress=function(){return o},this.stopScrolling=function(){b&&(clearTimeout(b),b=null),E=!1},d.svGrid){if(null===(S="true"===d.svGrid||"false"!==d.svGrid&&null))throw"Invalid value of sv-grid attribute"}else a.$watchCollection(function(){return t(w)},function(e){S=!1;var t=e.filter(function(e){return!e.container}).map(function(e){return{part:e.getPart().id,y:e.element[0].getBoundingClientRect().top}}),n=Object.create(null);t.forEach(function(e){n[e.part]?n[e.part].push(e.y):n[e.part]=[e.y]}),Object.keys(n).forEach(function(e){n[e].sort(),n[e].forEach(function(t,o){o<n[e].length-1&&t>0&&t===n[e][o+1]&&(S=!0)})})});this.$moveUpdate=function(n,r,i,d,u,m,b){var C,E,T=n.containment&&p.call(i,n.containment)[0],O=l(i[0],!0),R=l(h[0],!0),k=T&&l(T,!0),q=Math.max(R.top,k?k.top:0),B=Math.min(R.bottom,k?k.bottom:1/0);"element"===n.tolerance&&(r={x:~~(O.left+O.width/2),y:~~(O.top+O.height/2)}),f||(u?(f=u.clone(),f.removeClass("ng-hide")):(f=d.clone(),f.addClass("sv-visibility-hidden"),f.addClass("sv-placeholder"),f.css({height:O.height+"px",width:O.width+"px"})),d.after(f),d.addClass("ng-hide"),x=d,g=n,$=i,M(a,{$helper:{element:$},$part:m.model(m.scope),$index:b,$item:m.model(m.scope)[b]}),a.$root&&a.$root.$$phase||a.$apply()),C=f[0].getBoundingClientRect(),E={x:~~(C.left+C.width/2),y:~~(C.top+C.height/2)},o=!0,v=[],$[0].reposition({x:r.x-r.offset.x*O.width,y:r.y-r.offset.y*O.height},k),t(w).forEach(function(t,o){if(null==n.containment||c(t.element,n.containment)||c(t.element,n.containment+" *")){var i=t.element[0].getBoundingClientRect(),l={x:~~(i.left+i.width/2),y:~~(i.top+i.height/2)};t.container||!t.element[0].scrollHeight&&!t.element[0].scrollWidth||v.push({element:t.element,q:(l.x-r.x)*(l.x-r.x)+(l.y-r.y)*(l.y-r.y),view:t.getPart(),targetIndex:t.getIndex(),after:e(l,r,S)}),t.container&&!t.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&v.push({element:t.element,q:(l.x-r.x)*(l.x-r.x)+(l.y-r.y)*(l.y-r.y),view:t.getPart(),targetIndex:0,container:!0})}}),v.push({q:(E.x-r.x)*(E.x-r.x)+(E.y-r.y)*(E.y-r.y),element:f,placeholder:!0}),v.sort(function(e,t){return e.q-t.q}),v.forEach(function(e,t){0!==t||e.placeholder||e.container?0===t&&e.container?(y=e,e.element.append(f)):e.element.removeClass("sv-candidate"):(y=e,e.element.addClass("sv-candidate"),e.after?e.element.after(f):s(e.element,f))}),O=l(i[0],!0),q>O.top?P(-5,200):B<O.bottom?P(5,200):this.stopScrolling()},this.$drop=function(e,t,n){function r(){if(o=!1,f.remove(),$.remove(),x.removeClass("ng-hide"),v=void 0,f=void 0,n=void 0,$=void 0,x=void 0,T(a,{$part:e.model(e.scope),$index:t,$item:e.model(e.scope)[t]}),y){y.element.removeClass("sv-candidate");var r=e.model(e.scope).splice(t,1),i=y.targetIndex;y.view===e&&y.targetIndex>t&&i--,y.after&&i++,y.view.model(y.view.scope).splice(i,0,r[0]),y.view===e&&t===i||C(a,{$partTo:y.view.model(y.view.scope),$partFrom:e.model(e.scope),$item:r[0],$indexTo:i,$indexFrom:t})}y=void 0,a.$root&&a.$root.$$phase||a.$apply()}if(f)if(n.revert){var l=f[0].getBoundingClientRect(),s=$[0].getBoundingClientRect(),c=Math.sqrt(Math.pow(s.top-l.top,2)+Math.pow(s.left-l.left,2)),d=+n.revert*c/200;d=Math.min(d,+n.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){void 0!==$[0].style[e+"transition"]&&($[0].style[e+"transition"]="all "+d+"ms ease")}),setTimeout(r,d),$.css({top:l.top+i.scrollTop+"px",left:l.left+i.scrollLeft+"px"})}else r()},this.addToSortableElements=function(e){t(w).push(e)},this.removeFromSortableElements=function(e){var o=t(w),r=o.indexOf(e);r>-1&&(o.splice(r,1),0===o.length&&n(w))}}]}}]),h.directive("svPart",["$parse",function(e){return{restrict:"A",require:"^svRoot",controller:["$scope",function(e){e.$ctrl=this,this.getPart=function(){return e.part},this.$drop=function(t,n){e.$sortableRoot.$drop(e.part,t,n)}}],scope:!0,link:function(t,n,o,r){if(!o.svPart)throw new Error("no model provided");var i=e(o.svPart);if(!i.assign)throw new Error("model not assignable");t.part={id:t.$id,element:n,model:i,scope:t},t.$sortableRoot=r;var l={element:n,getPart:t.$ctrl.getPart,container:!0};r.addToSortableElements(l),t.$on("$destroy",function(){r.removeFromSortableElements(l)})}}}]),h.directive("svElement",["$parse",function(e){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(e){e.$ctrl=this}],link:function(n,r,i,l){function s(){x.off("touchstart",c),x.off("mousedown",u)}function c(e){function t(){n(),u(e,!0)}function n(e){clearTimeout(o),w.off(r,n)}var o,r=$+" "+g;w.on("touchmove "+f,n),o=setTimeout(t,d)}function u(s,c){function d(e){l[1].stopScrolling(),w.off($,u),w.off(g,d),w.removeClass("sv-sorting-in-progress"),m&&l[0].$drop(n.$index,S),r.removeClass("sv-visibility-hidden"),t.isDefined(f)&&(v.style.position=f)}function u(e){o(e),m||(r.parent().prepend(x),m=!0),l[1].$moveUpdate(S,{x:e.clientX,y:e.clientY,offset:C},x,r,h,l[0].getPart(),n.$index)}o(s);var f;if("relative"!==v.style.position&&(f=v.style.position,v.style.position="relative"),!l[1].sortingInProgress()&&(0==s.button||"mousedown"!==s.type)){var x,y=r,b=r[0].getBoundingClientRect(),S=e(i.svElement)(n),C={x:(s.clientX-b.left)/b.width,y:(s.clientY-b.top)/b.height};m=!1,S=t.extend({},{tolerance:"pointer",revert:200,containment:"html"},S),p||(p=l[0].helper),h||(h=l[0].placeholder),p?(x=p.clone(),x.removeClass("ng-hide"),x.css({left:b.left+v.scrollLeft+"px",top:b.top+v.scrollTop+"px"}),y.addClass("sv-visibility-hidden")):(x=y.clone(),x.addClass("sv-helper").css({left:b.left+v.scrollLeft+"px",top:b.top+v.scrollTop+"px",width:b.width+"px"})),x[0].reposition=function(e,t){var n,o,r,i,l=x[0].getBoundingClientRect(),s=a(x),c=s[0].getBoundingClientRect(),d=c.top-s[0].scrollTop,u=c.left-s[0].scrollLeft,m=e.x-u,p=e.y-d;t&&(n=t.top-d,o=t.left-u,r=n+t.height,i=o+t.width,p=Math.min(r-l.height,Math.max(p,n)),m=Math.min(i-l.width,Math.max(m,o))),this.style.left=m+"px",this.style.top=p+"px"},w.addClass("sv-sorting-in-progress"),w.on($,u).on(g,d),c&&u(s)}}var m,p,h,v=document.body,f="touchend touchcancel",g="mouseup "+f,$="mousemove touchmove",x=r,y={element:r,getPart:l[0].getPart,getIndex:function(){return n.$index}},b=!1,w=t.element(document.documentElement);l[1].addToSortableElements(y),n.$on("$destroy",function(){b=!0,s(),l[1].removeFromSortableElements(y)}),x.on("touchstart",c),x.on("mousedown",u),n.$watch("$ctrl.handle",function(e){e&&(s(),x=e,x.on("touchstart",c),x.on("mousedown",u))}),n.$watch("$ctrl.helper",function(e){e&&(p=e)}),n.$watch("$ctrl.placeholder",function(e){e&&(h=e)})}}}]),h.directive("svHandle",function(){return{require:"?^svElement",link:function(e,t,o,r){r&&(r.handle=n.call(t,r.handle))}}}),h.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-helper").addClass("ng-hide"),o[1]?o[1].helper=t:o[0]&&(o[0].helper=t)}}}),h.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-placeholder").addClass("ng-hide"),o[1]?o[1].placeholder=t:o[0]&&(o[0].placeholder=t)}}})}(window,window.angular);
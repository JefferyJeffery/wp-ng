angular.module("ash",[]).directive("ngInfiniteScroll",["$timeout","Data","Resource",function(t,o,s){return{restrict:"A",scope:{options:"=",items:"="},link:function(t,e){t.lastRemain=void 0,t.offset=0,t.inProcess=!1,t.options=angular.extend({limit:10,threshold:50,data:[]},t.options),t.hasItems=!0,t.options.resource||Array.isArray(t.options.data)||(t.options.data=[t.options.data]),t.strategy=t.options.resource?s:o,t.strategy.addItems(t),e.bind("scroll",function(){var o=e[0].scrollHeight-(e[0].clientHeight+e[0].scrollTop);o<t.options.threshold&&(!t.lastRemain||o-t.lastRemain<0)&&t.hasItems&&!t.inProcess&&t.$apply(function(){t.strategy.addItems(t)}),t.lastRemain=o})}}}]),app.factory("Data",function(){return{addItems:function(t){t.inProcess=!0;var o=t.offset*t.options.limit;if(o<t.options.data.length){var s=o+t.options.limit;s=s>t.options.data.length?t.options.data.length:s;for(var e=o;e<s;e++)t.items=t.items.concat(t.options.data[e]);t.offset++}else t.hasItems=!1;t.inProcess=!1}}}),app.factory("Resource",function(){return{addItems:function(t){t.inProcess=!0,t.options.resource.query({offset:t.offset*t.options.limit,limit:t.options.limit},function(o){if(0==o.models.length)t.hasItems=!1;else for(var s=0;s<o.models.length;s++)t.items=t.items.concat(o.models[s]);t.inProcess=!1})}}});
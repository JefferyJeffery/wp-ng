"use strict";angular.module("jtt_aping_tumblr",["jtt_tumblr"]).directive("apingTumblr",["apingTumblrHelper","apingUtilityHelper","tumblrFactory",function(t,e,i){return{require:"?aping",restrict:"A",replace:"false",link:function(a,o,r,s){var n=s.getAppSettings();e.parseJsonFromAttributes(r.apingTumblr,t.getThisPlatformString(),n).forEach(function(a){var o={model:n.model};void 0!==n.getNativeData?o.getNativeData=n.getNativeData:o.getNativeData=!1;var r={api_key:e.getApiCredentials(t.getThisPlatformString(),"api_key"),filter:"text"};if(void 0!==a.items?r.limit=a.items:r.limit=n.items,0==r.limit)return!1;if((r.limit<0||isNaN(r.limit))&&(r.limit=void 0),r.limit>20&&(r.limit=20),0===r.limit||"0"===r.limit)return!1;if(void 0!==a.tag&&(r.tag=a.tag),a.page){switch(r.page=a.page,n.model){case"image":r.type="photo";break;case"video":r.type="video";break;case"social":break;default:return!1}i.getPostsFromPage(r).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,o))})}})}}}]),angular.module("jtt_aping_tumblr").service("apingTumblrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(t,e,i){this.getThisPlatformString=function(){return"tumblr"},this.getThisBlogLink=function(t){return"http://"+t+".tumblr.com/"},this.getDifference=function(t,e){return t>e?t-e:e-t},this.getImagesFromImageArray=function(t){var e=this,i={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return t.constructor===Array&&angular.forEach(t,function(t,a){void 0!==t.url&&(void 0===i.thumb_url?(i.thumb_url=t.url,i.thumb_width=t.width,i.thumb_height=t.height):e.getDifference(i.thumb_width,200)>e.getDifference(t.width,200)&&t.width>=200&&(i.thumb_url=t.url,i.thumb_width=t.width,i.thumb_height=t.height),void 0===i.img_url?(i.img_url=t.url,i.img_width=t.width,i.img_height=t.height):e.getDifference(i.img_width,700)>e.getDifference(t.width,700)&&(i.img_url=t.url,i.img_width=t.width,i.img_height=t.height),void 0===i.native_url?(i.native_url=t.url,i.native_width=t.width,i.native_height=t.height):t.width>i.native_width&&(i.native_url=t.url,i.native_width=t.width,i.native_height=t.height))}),i},this.getObjectByJsonData=function(t,e){var i=[];if(t&&t.data&&t.data.response){var a=this;t.data.response.posts&&angular.forEach(t.data.response.posts,function(t,o){var r;(r=!0===e.getNativeData||"true"===e.getNativeData?t:a.getItemByJsonData(t,e.model))&&i.push(r)})}return i},this.getItemByJsonData=function(t,e){var i={};if(t&&e)switch(e){case"social":i=this.getSocialItemByJsonData(t);break;case"video":i=this.getVideoItemByJsonData(t);break;case"image":i=this.getImageItemByJsonData(t);break;default:return!1}return i},this.getSocialItemByJsonData=function(e){var i=t.getNew("social",this.getThisPlatformString());switch(angular.extend(i,{blog_name:e.blog_name||void 0,blog_link:e.blog_name?this.getThisBlogLink(e.blog_name):void 0,type:e.type||void 0,timestamp:e.timestamp?1e3*e.timestamp:void 0,post_url:e.short_url||void 0,intern_id:e.id||void 0}),e.type){case"photo":if(i.text=e.caption||void 0,e.photos&&e.photos[0]&&e.photos[0].alt_sizes&&e.photos[0].alt_sizes.length>0&&(i.source=e.photos,e.photos&&e.photos[0]&&e.photos[0].alt_sizes&&e.photos[0].alt_sizes.length>0)){i.source=e.photos;var a=this.getImagesFromImageArray(e.photos[0].alt_sizes);angular.extend(i,a)}break;case"link":if(i.text=e.description||void 0,i.text?i.caption=e.title||void 0:i.text=e.title||void 0,e.photos&&e.photos[0]&&e.photos[0].alt_sizes&&e.photos[0].alt_sizes.length>0&&(i.source=e.photos,e.photos&&e.photos[0]&&e.photos[0].alt_sizes&&e.photos[0].alt_sizes.length>0)){i.source=e.photos;var a=this.getImagesFromImageArray(e.photos[0].alt_sizes);angular.extend(i,a)}break;case"video":i.text=e.caption||void 0,e.thumbnail_url&&(i.img_url=e.thumbnail_url,i.thumb_url=e.thumbnail_url,i.native_url=e.thumbnail_url),e.player&&(i.source=e.player);break;case"text":i.text=e.body||void 0,i.text?i.caption=e.title||void 0:i.text=e.title||void 0;break;case"audio":i.text=e.caption||void 0,e.player&&(i.source=e.player);break;default:return!1}return i.date_time=new Date(i.timestamp),i},this.getVideoItemByJsonData=function(e){var i=t.getNew("video",this.getThisPlatformString());return angular.extend(i,{blog_name:e.blog_name||void 0,blog_link:e.blog_name?this.getThisBlogLink(e.blog_name):void 0,type:e.type||void 0,timestamp:e.timestamp?1e3*e.timestamp:void 0,post_url:e.short_url||void 0,intern_id:e.id||void 0,text:e.caption||void 0,img_url:e.thumbnail_url||void 0,thumb_url:e.thumbnail_url||void 0,native_url:e.thumbnail_url||void 0}),angular.forEach(e.player,function(t,e){(void 0===i.markup||t.width>i.width)&&(i.markup=t.embed_code,i.width=t.width)}),i.date_time=new Date(i.timestamp),i},this.getImageItemByJsonData=function(e){var i=t.getNew("image",this.getThisPlatformString());if(angular.extend(i,{blog_name:e.blog_name||void 0,blog_link:e.blog_name?this.getThisBlogLink(e.blog_name):void 0,type:e.type||void 0,timestamp:e.timestamp?1e3*e.timestamp:void 0,post_url:e.short_url||void 0,intern_id:e.id||void 0}),i.text=e.caption||void 0,e.photos&&e.photos[0]&&e.photos[0].alt_sizes&&e.photos[0].alt_sizes.length>0){i.source=e.photos;var a=this.getImagesFromImageArray(e.photos[0].alt_sizes);angular.extend(i,a)}return i.date_time=new Date(i.timestamp),i}}]),angular.module("jtt_tumblr",[]).factory("tumblrFactory",["$http","tumblrSearchDataService",function(t,e){var i={};return i.getPostsFromPage=function(i){var a=e.getNew("postsFromPage",i);return t.jsonp(a.url,{method:"GET",params:a.object})},i.getInfoFromPage=function(i){var a=e.getNew("infoFromPage",i);return t.jsonp(a.url,{method:"GET",params:a.object})},i.getAvatarFromPage=function(i){var a=e.getNew("avatarFromPage",i);return t.jsonp(a.url,{method:"GET",params:a.object})},i}]).service("tumblrSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://api.tumblr.com/"+(t&&void 0!==t.version?t.version+"/":"v2/")+"blog/"},this.fillDataInObjectByList=function(t,e,i){return angular.forEach(i,function(i,a){void 0!==e[i]&&(t.object[i]=e[i])}),t},this.getNew=function(t,e){var i={object:{api_key:e.api_key||void 0,callback:"JSON_CALLBACK"},url:""};switch(void 0!==e.limit&&(i.object.limit=e.limit),t){case"postsFromPage":i=this.fillDataInObjectByList(i,e,["type","id","tag","offset","reblog_info","notes_info","filter"]),i.url=this.getApiBaseUrl()+e.page+".tumblr.com/posts";break;case"infoFromPage":i.object.limit=void 0,i.url=this.getApiBaseUrl()+e.page+".tumblr.com/info";break;case"avatarFromPage":i.object.limit=void 0;var a="";void 0!==e.size&&(a="/"+e.size),i.url=this.getApiBaseUrl()+e.page+".tumblr.com/avatar"+a}return i}});
!function(r){"use strict";var n=r.module("ngAntimoderate",[]);n.provider("$ngAntimoderate",[function(){var r={load:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",error:void 0};this.src=r,this.$get=[function(){var r=this.src;return{getSrc:function(){return r}}}],this.setSrc=function(n){this.src.load=n.load||r.load,this.src.error=n.error||r.error}}]),n.directive("ngAntimoderate",["$timeout","$window","$ngAntimoderate",function(n,i,o){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&",onError:"&"},transclude:!1,link:function(t,e,a){function s(r){return parseFloat(r)*(/\ds$/.test(r)?1e3:1)}function l(r,n){return n=n||document.createElement("div"),r.parentNode.appendChild(n),n.appendChild(r),n}function c(r){var n={image:new Image,src:r};return n.image.src=r,n}function d(r){return null}function f(r,n){if(n.transition&&n.overflow){var i=l(r);i.classList.add("antimoderate-overflow"),i.style.width="100%",i.style.height="100%",i.style.overflow="hidden"}return r}function u(r,n){return n.load_delay>0&&(r.style.opacity=0,r.style.transition="opacity "+n.load_delay+"ms"),r.classList.remove(n.loaded_class),r.classList.add(n.loading_class),r}function m(r,i){return i.load_delay>0&&(r.style.transition="opacity "+i.load_delay+"ms",r.style.opacity=1,n(function(){r.style.opacity=""},s(r.style.transitionDuration))),r}function g(r,n){return n.filter&&(r.style.filter=n.filter),r}function A(r,i){return i.transition&&(r.style.transition=i.transition),i.filter&&(r.style.filter="none "),n(function(){i.filter&&(r.style.filter=""),i.transition&&(i.overflow&&(r.parentElement.style.overflow=""),r.style.transition="")},s(r.style.transitionDuration)),r}function y(r,n){return r.classList.remove(n.loading_class),r.classList.add(n.loaded_class),r}function v(n,o,t){return n.src=o,r.isDefined(i.objectFitImages)&&r.isFunction(i.objectFitImages)&&objectFitImages("img.antimoderate"),n}function _(r,i,o,e){o.original=c(r),o.original.image.onload=function(){C.push(p.src),e.then(function(){n(function(){v(p,o.original.src,i),d(o.micro),d(o.original),y(p,i),A(p,i),t.onSuccess()},0)})},o.original.image.onerror=function(){o.err=c(i.err_src),o.err.image.onload=function(){e.then(function(){n(function(){v(p,o.err.src,i),d(o.micro),d(o.original),d(o.err),y(p,i),A(p,i),t.onError()},0)})}}}var h=o.getSrc(),p=e[0],w={},C=[],D={},S=h.load,E=h.error;w.micro_src=t.ngAntimoderate||"",w.load_src=t.loadSrc||S,w.err_src=t.errSrc||E||S,w.load_delay=parseInt(t.loadDelay)||300,w.filter=r.isDefined(t.filter)?t.filter:"blur(20px)",w.transition=r.isDefined(t.transition)?t.transition:"filter 300ms",w.loading_class=r.isDefined(t.loadingClass)?t.loadingClass:"loading",w.loaded_class=r.isDefined(t.loadedClass)?t.loadedClass:"loaded",w.overflow=!r.isDefined(t.overflow)||t.overflow;var I=function(r,i){var o=r[0];D.load=c(i.load_src),D.load.image.onload=function(){f(o,i),i.micro_src=i.micro_src.length?i.micro_src:i.load_src,D.micro=c(i.micro_src),D.micro.image.onload=function(){u(o,i);var r=n(function(){v(o,D.micro.src,i),d(D.load),m(o,i),g(o,i)},i.load_delay>0?i.load_delay/2:0);_(a.src,i,D,r)},D.micro.image.onerror=function(){u(o,i);var r=n(function(){d(D.load),m(o,i),g(o,i)},0);_(a.src,i,D,r)},n(function(){v(o,D.load.src,i)},0)}};e.addClass("antimoderate"),-1===C.indexOf(p.src)&&I(e,w),t.$watch("ngAntimoderate",function(r,n){r!==n&&-1===C.indexOf(p.src)&&(w.micro_src=r,I(e,w))})}}}])}(window.angular);
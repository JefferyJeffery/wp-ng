"use strict";angular.module("jtt_aping_facebook",["jtt_facebook"]).directive("apingFacebook",["apingFacebookHelper","apingUtilityHelper","facebookFactory","facebookPagesImages",function(t,e,i,a){return{require:"?aping",restrict:"A",replace:"false",link:function(o,r,n,s){var c=s.getAppSettings();e.parseJsonFromAttributes(n.apingFacebook,t.getThisPlatformString(),c).forEach(function(o){var r={model:c.model,showAvatar:o.showAvatar||!1};void 0!==c.getNativeData?r.getNativeData=c.getNativeData:r.getNativeData=!1;var n={page:o.page,access_token:e.getApiCredentials(t.getThisPlatformString(),"access_token")};if(void 0!==o.items?n.limit=o.items:n.limit=c.items,0===n.limit||"0"===n.limit)return!1;if((n.limit<0||isNaN(n.limit))&&(n.limit=void 0),n.limit>100&&(n.limit=100),o.page)switch(c.model){case"social":!0===r.showAvatar||"true"===r.showAvatar?i.getPageById({page:n.page,access_token:n.access_token}).then(function(e){e&&e.data&&e.data.id&&e.data.cover&&e.data.cover.source&&(a[e.data.id]=e.data.cover.source),i.getPostsFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))})}):i.getPostsFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))});break;case"video":!0===r.showAvatar||"true"===r.showAvatar?i.getPageById({page:n.page,access_token:n.access_token}).then(function(e){e&&e.data&&e.data.id&&e.data.cover&&e.data.cover.source&&(a[e.data.id]=e.data.cover.source),i.getVideosFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))})}):i.getVideosFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))});break;case"image":i.getPhotosFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))});break;case"event":!0===r.showAvatar||"true"===r.showAvatar?i.getPageById({page:n.page,access_token:n.access_token}).then(function(e){e&&e.data&&e.data.id&&e.data.cover&&e.data.cover.source&&(a[e.data.id]=e.data.cover.source),i.getEventsFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))})}):i.getEventsFromPageById(n).then(function(e){e&&s.concatToResults(t.getObjectByJsonData(e,c))})}})}}}]),angular.module("jtt_aping_facebook").service("apingFacebookHelper",["apingModels","apingTimeHelper","apingUtilityHelper","facebookPagesImages",function(t,e,i,a){this.getThisPlatformString=function(){return"facebook"},this.getThisPlatformLink=function(){return"https://facebook.com/"},this.getRatioFromFormatObject=function(t){var e={width:void 0,height:void 0};if(void 0!==t&&t.constructor===Array)return angular.forEach(t,function(t,i){void 0!==t.filter&&"native"===t.filter&&(void 0!==t.width&&(e.width=t.width),void 0!==t.height&&(e.height=t.height))}),e},this.getDifference=function(t,e){return t>e?t-e:e-t},this.getImagesFromArray=function(t,e){angular.isUndefined(e)&&(e="source");var i=this,a={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return t.constructor===Array&&angular.forEach(t,function(t,o){angular.isDefined(t[e])&&(angular.isUndefined(a.thumb_url)?(a.thumb_url=t[e],a.thumb_width=t.width,a.thumb_height=t.height):i.getDifference(a.thumb_width,200)>i.getDifference(t.width,200)&&t.width>=200&&(a.thumb_url=t[e],a.thumb_width=t.width,a.thumb_height=t.height),angular.isUndefined(a.img_url)?(a.img_url=t[e],a.img_width=t.width,a.img_height=t.height):i.getDifference(a.img_width,700)>i.getDifference(t.width,700)&&(a.img_url=t[e],a.img_width=t.width,a.img_height=t.height),angular.isUndefined(a.native_url)?(a.native_url=t[e],a.native_width=t.width,a.native_height=t.height):t.width>a.native_width&&(a.native_url=t[e],a.native_width=t.width,a.native_height=t.height))}),a},this.getObjectByJsonData=function(t,e){var i=[];if(t){var a=this;t.data&&t.data.data&&angular.forEach(t.data.data,function(t,o){var r;(r=!0===e.getNativeData||"true"===e.getNativeData?t:a.getItemByJsonData(t,e))&&i.push(r)})}return i},this.getItemByJsonData=function(t,e){var i={};if(t&&e.model)switch(e.model){case"social":i=this.getSocialItemByJsonData(t,e);break;case"video":i=this.getVideoItemByJsonData(t,e);break;case"image":i=this.getImageItemByJsonData(t,e);break;case"event":i=this.getEventItemByJsonData(t,e);break;default:return!1}return i},this.getSocialItemByJsonData=function(i,o){var r=t.getNew("social",this.getThisPlatformString());switch(angular.extend(r,{blog_name:i.from.name,blog_id:i.from.id,blog_link:this.getThisPlatformLink()+i.from.id+"/",intern_type:i.type,intern_id:i.id,thumb_url:i.picture,img_url:i.full_picture,native_url:i.full_picture,timestamp:e.getTimestampFromDateString(i.created_time,1e3,36e5)}),r.date_time=new Date(r.timestamp),i.type){case"photo":r.type="image",r.post_url=i.link,r.text=i.message;break;case"status":r.type="post";break;case"link":r.type="link",r.post_url=this.getThisPlatformLink()+i.id+"/",r.content_url=i.link,r.caption=i.name;break;case"video":r.type="video",i.name&&(r.caption=i.name);break;case"event":r.type="event",r.text=i.description,r.caption=i.caption||i.name||void 0}return r.text||(r.text=i.message),r.text||(r.text=i.name),r.post_url||(i.id?r.post_url=this.getThisPlatformLink()+i.id+"/":r.post_url=i.link),!0!==o.showAvatar&&"true"!==o.showAvatar||r.img_url||a[i.from.id]&&(r.img_url=a[i.from.id]),r},this.getVideoItemByJsonData=function(i,o){var r=t.getNew("video",this.getThisPlatformString());if(angular.extend(r,{blog_name:i.from.name,blog_id:i.from.id,blog_link:this.getThisPlatformLink()+i.from.id+"/",intern_id:i.id,post_url:i.permalink_url,timestamp:e.getTimestampFromDateString(i.created_time,1e3,36e5),text:i.description,markup:i.embed_html||void 0,source:i.source||void 0}),r.date_time=new Date(r.timestamp),void 0!==i.length&&(r.length=i.length),void 0!==i.format&&i.format.length>0){var n=this.getImagesFromArray(i.format,"picture");n.thumb_width=void 0,n.thumb_height=void 0,n.img_width=void 0,n.img_height=void 0,n.native_width=void 0,n.native_height=void 0,angular.extend(r,n);var s=this.getRatioFromFormatObject(i.format);void 0!==s.width&&(r.width=s.width),void 0!==s.height&&(r.height=s.height)}return!0!==o.showAvatar&&"true"!==o.showAvatar||r.img_url||a[i.from.id]&&(r.img_url=a[i.from.id]),r},this.getImageItemByJsonData=function(i,a){var o=t.getNew("image",this.getThisPlatformString());if(angular.extend(o,{blog_name:i.from.name,blog_id:i.from.id,blog_link:this.getThisPlatformLink()+i.from.id+"/",intern_id:i.id,post_url:i.link,timestamp:e.getTimestampFromDateString(i.created_time,1e3,36e5),text:i.name||void 0,source:i.images||void 0}),o.date_time=new Date(o.timestamp),i.images.length>0){var r=this.getImagesFromArray(i.images,"source");angular.extend(o,r)}return o},this.getEventItemByJsonData=function(i,o){var r=t.getNew("event",this.getThisPlatformString());return angular.extend(r,{artist_name:i.owner.name,artist_id:i.owner.id,artist_link:this.getThisPlatformLink()+i.owner.id+"/",intern_id:i.id,event_url:this.getThisPlatformLink()+i.owner.id+"_"+i.id+"/",ticket_url:i.ticket_uri||void 0,start_timestamp:e.getTimestampFromDateString(i.start_time,1e3,36e5),end_timestamp:i.end_time?e.getTimestampFromDateString(i.end_time,1e3,36e5):void 0,caption:i.name||void 0,text:i.description||void 0,img_url:i.cover?i.cover.source:void 0}),r.start_timestamp&&(r.start_date_time=new Date(r.start_timestamp)),r.end_timestamp&&(r.end_date_time=new Date(r.end_timestamp)),i.place&&(r.place_name=i.place.name||void 0,i.place.location&&(r.city=i.place.location.city||void 0,r.country=i.place.location.country||void 0,r.latitude=i.place.location.latitude||void 0,r.longitude=i.place.location.longitude||void 0,r.street=i.place.location.street||void 0,r.zip=i.place.location.zip||void 0)),!0!==o.showAvatar&&"true"!==o.showAvatar||r.img_url||a[i.from.id]&&(r.img_url=a[i.from.id]),r}}]),angular.module("jtt_aping_facebook").config(["$provide",function(t){t.value("facebookPagesImages",{})}]),angular.module("jtt_facebook",[]).factory("facebookFactory",["$http","facebookSearchDataService",function(t,e){var i={};return i.getPostsFromPageById=function(i){var a=e.getNew("postsFromPageById",i);return t({method:"GET",url:a.url,params:a.object})},i.getPhotosFromPageById=function(i){var a=e.getNew("photosFromPageById",i);return t({method:"GET",url:a.url,params:a.object})},i.getVideosFromPageById=function(i){var a=e.getNew("videosFromPageById",i);return t({method:"GET",url:a.url,params:a.object})},i.getEventsFromPageById=function(i){var a=e.getNew("eventsFromPageById",i);return t({method:"GET",url:a.url,params:a.object})},i.getPageById=function(i){var a=e.getNew("pageById",i);return t({method:"GET",url:a.url,params:a.object})},i}]).service("facebookSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://graph.facebook.com/"+(t&&void 0!==t.version?t.version+"/":"v2.5/")},this.fillDataInObjectByList=function(t,e,i){return angular.forEach(i,function(i,a){void 0!==e[i]&&(t.object[i]=e[i])}),t},this.getNew=function(t,e){var i={object:{access_token:e.access_token||void 0},url:""};switch(void 0!==e.limit&&(i.object.limit=e.limit),t){case"postsFromPageById":i.object.fields="id,message,story,created_time,full_picture,from,link,description,type,shares,source,picture,object_id",i=this.fillDataInObjectByList(i,e,["__paging_token","until","since","__previous"]),i.url=this.getApiBaseUrl()+e.page+"/posts?";break;case"photosFromPageById":i.object.fields="id,created_time,from,link,picture,album,name,images,width,height",i=this.fillDataInObjectByList(i,e,["before","after"]),i.url=this.getApiBaseUrl()+e.page+"/photos?";break;case"videosFromPageById":i.object.fields="id,created_time,from,description,source,picture,format,title,embed_html,permalink_url,length",i=this.fillDataInObjectByList(i,e,["before","after"]),i.url=this.getApiBaseUrl()+e.page+"/videos?";break;case"eventsFromPageById":i.object.fields="id,owner,description,picture{url},end_time,name,cover,category,place,start_time,ticket_uri",i=this.fillDataInObjectByList(i,e,["before","after"]),i.url=this.getApiBaseUrl()+e.page+"/events?";break;case"pageById":i.object.fields="cover,link,picture{url},username,name",i.object.limit=void 0,i.url=this.getApiBaseUrl()+e.page+"/"}return i}});
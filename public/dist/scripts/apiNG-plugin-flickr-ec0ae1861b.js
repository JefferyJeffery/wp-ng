"use strict";angular.module("jtt_aping_flickr",["jtt_flickr"]).directive("apingFlickr",["apingFlickrHelper","apingUtilityHelper","flickrFactory",function(t,e,i){return{require:"?aping",restrict:"A",replace:"false",link:function(a,r,s,n){var o=n.getAppSettings();e.parseJsonFromAttributes(s.apingFlickr,t.getThisPlatformString(),o).forEach(function(e){var a={model:o.model};if(void 0!==e.items?a.items=e.items:a.items=o.items,void 0!==o.getNativeData?a.getNativeData=o.getNativeData:a.getNativeData=!1,0===a.items||"0"===a.items)return!1;(a.items<0||isNaN(a.items))&&(a.items=void 0),a.items>20&&(a.items=20);var r={items:a.items};void 0!==e.language&&(r.lang=e.language),e.userId?(r.id=e.userId,i.getImagesFromUserById(r).then(function(e){n.concatToResults(t.getObjectByJsonData(e,a))})):e.tags&&(r.tags=e.tags,e.tagmode&&(r.tagmode=e.tagmode),i.getImagesByTags(r).then(function(e){n.concatToResults(t.getObjectByJsonData(e,a))}))})}}}]),angular.module("jtt_aping_flickr").service("apingFlickrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(t,e,i){this.getThisPlatformString=function(){return"flickr"},this.getThisPlatformLink=function(){return"http://flickr.com/"},this.getUserNameFromString=function(t){var e=t.replace("nobody@flickr.com (","");return e=e.substr(0,e.length-1)},this.removeOverHeadFromDescription=function(t){if(angular.isDefined(t)&&"string"==typeof t){var e=t.split("posted a photo:");e.length>1&&(t=e[1].trim()),""===t&&(t=void 0)}return t},this.getObjectByJsonData=function(t,e){var i=[];if(t){var a=this;t.data&&t.data.items&&angular.forEach(t.data.items,function(t,r){if(angular.isUndefined(e.items)||e.items>0&&i.length<e.items){var s=a.getItemByJsonData(t,e);s&&i.push(s)}})}return i},this.getItemByJsonData=function(t,e){var i={};if(t&&e.model)if(!0===e.getNativeData||"true"===e.getNativeData)i=this.getNativeItemByJsonData(t);else switch(e.model){case"social":i=this.getSocialItemByJsonData(t);break;case"image":i=this.getImageItemByJsonData(t);break;default:return!1}return i},this.getSocialItemByJsonData=function(a){var r=t.getNew("social",this.getThisPlatformString());return angular.extend(r,{blog_name:a.author?this.getUserNameFromString(a.author):void 0,blog_id:a.author_id||void 0,blog_link:a.author_id?this.getThisPlatformLink()+a.author_id:void 0,timestamp:e.getTimestampFromDateString(a.published,1e3,36e5),post_url:a.link,intern_id:a.link.split("flickr.com").length>=2?a.link.split("flickr.com")[1]:void 0,thumb_url:a.media?a.media.m:void 0,img_url:a.media?a.media.m.replace("_m.","."):void 0}),r.native_url=r.img_url,r.text=a.description?this.removeOverHeadFromDescription(i.getTextFromHtml(a.description)):void 0,a.title&&(r.text?r.caption=a.title:r.text=a.title),r.date_time=new Date(r.timestamp),a.description.indexOf("posted a photo")>-1&&(r.type="image",r)},this.getImageItemByJsonData=function(a){var r=t.getNew("image",this.getThisPlatformString());return angular.extend(r,{blog_name:a.author?this.getUserNameFromString(a.author):void 0,blog_id:a.author_id||void 0,blog_link:a.author_id?this.getThisPlatformLink()+a.author_id:void 0,timestamp:e.getTimestampFromDateString(a.published,1e3,36e5),post_url:a.link,intern_id:a.link.split("flickr.com").length>=2?a.link.split("flickr.com")[1]:void 0,thumb_url:a.media?a.media.m:void 0,img_url:a.media?a.media.m.replace("_m.","."):void 0}),r.native_url=r.img_url,r.text=a.description?this.removeOverHeadFromDescription(i.getTextFromHtml(a.description)):void 0,a.title&&"untitled"!==a.title.toLowerCase()&&(r.text?r.caption=a.title:r.text=a.title),r.date_time=new Date(r.timestamp),!(a.description.indexOf("posted a photo")<=0)&&r},this.getNativeItemByJsonData=function(t){return!(t.description.indexOf("posted a photo")<=0)&&t}}]),angular.module("jtt_flickr",[]).factory("flickrFactory",["$http","flickrSearchDataService",function(t,e){var i={};return i.getImagesFromUserById=function(i){var a=e.getNew("imagesFromUserById",i);return t({method:"JSONP",url:a.url,params:a.object})},i.getImagesFromGroupOfUsersByIds=function(i){var a=e.getNew("imagesFromGroupOfUsersByIds",i);return t({method:"JSONP",url:a.url,params:a.object})},i.getImagesByTags=function(i){var a=e.getNew("imagesByTags",i);return t({method:"JSONP",url:a.url,params:a.object})},i}]).service("flickrSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://api.flickr.com/services/feeds/photos_public.gne"},this.fillDataInObjectByList=function(t,e,i){return angular.forEach(i,function(i,a){angular.isDefined(e[i])&&(t.object[i]=e[i])}),t},this.getNew=function(t,e){var i={object:{jsoncallback:"JSON_CALLBACK",format:"json"},url:""};switch(t){case"imagesFromUserById":i=this.fillDataInObjectByList(i,e,["lang","id"]),i.url=this.getApiBaseUrl();break;case"imagesFromGroupOfUsersByIds":i=this.fillDataInObjectByList(i,e,["lang","ids"]),i.url=this.getApiBaseUrl();break;case"imagesByTags":i=this.fillDataInObjectByList(i,e,["lang","tags","tagmode"]),i.url=this.getApiBaseUrl()}return i}});